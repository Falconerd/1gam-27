var t=document.getElementById("canvas"),i=t.getContext("2d");t.width=710,t.height=400;var e=!1,h,s,a={x:0,y:0,lastX:0,lastY:0,velX:0,velY:0,radius:0},l,n,r=[],o=1,d=2,f=0,g=0,u=0,y=0,c=0,w,x="start",p,v=0,m=5,b=!1,S,P=.12,M,k=.12,A=new Audio("bg.mp3");A.loop=!0,A.volume=.25,A.load(),window.onload=function(){t.addEventListener("mousemove",X,!1),t.addEventListener("click",q,!1),window.addEventListener("keyup",T,!1),B(),s=Date.now(),O()},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var T=function(t){38===t.keyCode?A.volume>=1?A.volume=1:A.volume+=.1:40===t.keyCode&&(A.volume<=.1?A.volume=0:A.volume-=.1)},B=function(){t.style.cursor="default","playing"===x?(C(),t.style.cursor="none"):"start"===x?p=new E:"restart"===x&&(p=new E)},C=function(){l=new Y(t.width/2,t.height/2),l.endPoints.push(l),n=new F,r=[],u=0,y=0,f=0,g=0,c=0,v=0,m=5,S=new D(10),M=new D(10),S.init("nomnom"),M.init("hit"),A.play(),r.push(l),r.push(n)},I=function(){if("playing"!==x)return void p.update();m--,0>=m&&(m=5,v++,v>600&&(v=600,o-=.01,.5>o&&(o=.5)));for(var i=r.length-1;i>=0;i--)r[i]&&r[i].update();if(f+=h,f>=1e3*o){f=0;var e=Math.randomBetween(0,t.width),s=Math.randomBetween(0,t.height),a=Math.random();1>=a&&a>.75?s=-20:.75>=a&&a>.5?e=t.width+20:.5>=a&&a>.25?s=t.height+20:e=-20;var l=Math.randomBetween(1,7);r.push(new U(e,s,l))}if(g+=h,g>=1e3*d&&4>u){u++,g=0;var e=Math.randomBetween(10,t.width-10),s=Math.randomBetween(40,t.height-10);r.push(new N(e,s))}},R=function(){if(i.clearRect(0,0,t.width,t.height),"playing"!==x)return void p.draw();for(var e=r.length-1;e>=0;e--)r[e].draw();W.draw(),b&&(i.beginPath(),i.fillStyle="red",i.arc(l.x,l.y,1,0,2*Math.PI),i.fill(),i.closePath(),i.beginPath(),i.fillStyle="red",i.arc(n.x,n.y,1,0,2*Math.PI),i.fill(),i.closePath(),i.beginPath(),i.fillStyle="green",i.arc(a.x,a.y,1,0,2*Math.PI),i.fill(),i.closePath())},W={height:30,healthBarWidth:100,healthBarHeight:4,draw:function(){i.shadowBlur=0,i.fillStyle="rgba(30, 30, 30, 1)",i.fillRect(0,0,t.width,this.height),i.save(),i.translate(10,10),i.fillStyle="rgba(40, 40, 40, 0.8)",i.fillRect(0,2,this.healthBarWidth,this.healthBarHeight),i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=14,i.shadowColor="rgba(0, 240, 255, 0.9)",i.fillStyle="rgba(0, 200, 220, 0.8)",i.fillRect(0,2,l.health/l.maxHealth*this.healthBarWidth,this.healthBarHeight),i.translate(120,0),i.shadowBlur=0,i.fillStyle="#ffffff",i.fillText("MULTIPLIER: ",0,8),i.translate(72,0),i.fillStyle="rgba(0, 200, 220, 0.8)",i.fillText(l.tail.length,0,8),i.translate(20,0),i.font="10px Arial",i.fillStyle="#ffffff",i.fillText("SCORE: ",0,8),i.translate(46,0),i.fillStyle="rgba(0, 200, 220, 0.8)",i.fillText(c,0,8),i.restore()}},E=function(e){this.width=t.width/2,this.height=t.height/2,this.title="INSTRUCTIONS",this.text1="Use the cursor to control yourself.",this.text2="Eat green things. Avoid red things.",this.button="BEGIN";for(var h in e)e.hasOwnProperty(h)&&(this[h]=e[h]);this.draw=function(){i.save(),i.translate(t.width/2-this.width/2,t.height/2-this.height/2),i.translate(this.width/2,-44),i.textAlign="center",i.font="38px Arial",i.fillStyle="rgba(255,255,255,1)",i.fillText("MULTIPLY",0,0),i.restore(),i.save(),i.translate(t.width/2-this.width/2,t.height/2-this.height/2),i.fillStyle="rgba(30, 30, 30, 0.1)",i.strokeStyle="rgba(50, 50, 50, 0.5)",i.shadowBlur=20,i.shadowColor="rgba(0, 240, 255, 0.1)",i.fillRect(0,0,this.width,this.height),i.strokeRect(0,0,this.width,this.height),i.translate(this.width/2,30),i.textAlign="center",i.font="bold 18px Arial",i.fillStyle="#ffffff",i.fillText(this.title,0,0),i.translate(0,30),i.font="12px Arial",i.fillText(this.text1,0,0),i.fillText(this.text2,0,20),i.translate(0,90),i.font="18px Arial",i.fillStyle="rgba(0, 200, 220, 0.8)",i.shadowBlur=20,i.shadowColor="rgba(0, 240, 255, 0.6)",i.fillText(this.button,0,0),i.restore()},this.update=function(){}},O=function(){var t=Date.now();h=t-s,w=Math.round(1/(h/1e3)),w>58&&(w=60),I(),R(),s=t,requestAnimFrame(O)},X=function(i){var e=t.getBoundingClientRect();a.lastX=a.x,a.lastY=a.y,a.x=i.clientX-e.left,a.y=i.clientY-e.top,a.velX=Math.abs(a.x-a.lastX)/t.width,a.velX=Math.abs(a.y-a.lastY)/t.height},q=function(){("start"===x||"restart"===x)&&a.x>280&&a.x<420&&a.y>230&&a.y<280&&(x="playing",B())};Math.degToRad=function(t){return t*Math.PI/180},Math.radToDeg=function(t){return 180*t/Math.PI},Math.randomBetween=function(t,i){return Math.floor(Math.random()*(i-t+1))+t},Number.prototype.between=function(t,i){return this>t&&i>this},combineRGBA=function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"};var H=function(t,i){this.x=t||0,this.y=i||0,this.interpolate=function(t,i,e){this.x+=(t-this.x)*e,this.y+=(i-this.y)*e},this.getPointAlongAxis=function(t,i){return{x:i*Math.cos(t)+this.x,y:i*Math.sin(t)+this.y}},this.getPointAlongAxis2=function(t,i){return{x:i*Math.cos(Math.degToRad(t))+this.x,y:i*Math.sin(Math.degToRad(t))+this.y}},this.getMidPoint=function(t,i){return{x:.5*(t.x+i.x),y:.5*(t.y+i.y)}},this.add=function(t){return{x:this.x+t.x,y:this.y+t.y}}},L=function(t,e,h){this.x=t||0,this.y=e||0,this.radius=h||3,this.angle=0,this.speed=25,this.update=function(){},this.draw=function(){},this.getCentre=function(){return{x:this.x-this.radius,y:this.y-this.radius}},this.distanceTo=function(t){i.beginPath(),i.arc(this.x,this.y,1,0,2*Math.PI),i.arc(t.x,t.y,1,0,2*Math.PI),i.fill();var e=this.x-t.x,h=this.y-t.y;return Math.sqrt(e*e+h*h)},this.angleTo=function(t){return Math.atan2(t.getCentre().y-this.getCentre().y,t.getCentre().x-this.getCentre().x)},this.kill=function(){var t=r.indexOf(this);t>-1&&r.splice(t,1)}};L.prototype=new H;var Y=function(t,e){this.x=t||0,this.y=e||0,this.radius=6,this.tail=[],this.decaying=[],this.endPoints=[],this.children=[],this.health=100,this.maxHealth=100,this.vulnerable=!0,this.draw=function(){for(var t=this.decaying.length-1;t>=0;t--)this.decaying[t].draw();i.save(),i.translate(this.x,this.y),i.rotate(this.angle),i.shadowBlur=20,i.lineWidth=2,i.fillStyle="rgba(0, 255, 255, 0.9)",i.strokeStyle="rgba(255, 255, 255, 0.4)",i.shadowColor="rgba(0, 255, 255, 0.9)",i.beginPath(),i.arc(0,0,this.radius,.3*Math.PI,1.3*Math.PI),i.fill(),i.stroke(),i.beginPath(),i.arc(0,0,this.radius,.7*Math.PI,1.7*Math.PI),i.fill(),i.stroke(),i.restore();for(var t=this.tail.length-1;t>=0;t--)this.tail[t].draw()},this.update=function(){this.distanceTo(n)>2*this.radius&&(this.angle=this.angleTo(n),this.interpolate(n.x,n.y,.1));for(var t=this.tail.length-1;t>=0;t--)this.tail[t].update();for(var t=this.decaying.length-1;t>=0;t--)this.decaying[t].update()},this.getCentre=function(){return{x:this.x,y:this.y}},this.grow=function(){S.get(),this.health+=this.tail.length+1,this.health>this.maxHealth&&(this.health=this.maxHealth),c+=100*(this.tail.length+1),this.endPoints.length>2&&(this.endPoints=this.endPoints.slice(2));var t=this.endPoints.slice(0);this.endPoints=[];for(var i=t.length-1;i>=0;i--)if(Math.random()<.25){var e=new G(t[i].x,t[i].y,Math.randomBetween(1,5),225,t[i]),h=new G(t[i].x,t[i].y,Math.randomBetween(1,5),135,t[i]);this.tail.push(e),this.tail.push(h),this.endPoints.push(e),this.endPoints.push(h)}else{var e=new G(t[i].x,t[i].y,Math.randomBetween(1,5),0,t[i]);this.tail.push(e),this.endPoints.push(e)}},this.damage=function(t){M.get(),this.health-=20,this.health<0&&(this.health=0,this.kill());for(var i=t.children.length-1;i>=0;i--)t.children[i].kill();t.kill()},this.kill=function(){this.health=0,x="restart",B()}};Y.prototype=new L;var F=function(t,e){this.x=t||0,this.y=e||0,this.radius=2,this.draw=function(){i.strokeStyle=this.stroke,i.fillStyle=this.fill,i.beginPath(),i.arc(this.x,this.y,this.radius,0,2*Math.PI),i.shadowBlur=20,i.lineWidth=2,i.fillStyle="rgba(255, 153, 0, 0.9)",i.strokeStyle="rgba(255, 255, 255, 0.4)",i.shadowColor="rgba(255, 153, 0, 0.9)",i.fill(),i.stroke()},this.update=function(){this.interpolate(a.x,a.y,.9)}};F.prototype=new L;var G=function(t,e,h,s,a){this.x=t||0,this.y=e||0,this.radius=h||3,this.offsetAngle=s||0,this.target=a||l,this.speed=4,this.children=[],this.fillStyle={r:0,g:255,b:255,a:.9},this.strokeStyle={r:255,g:255,b:255,a:.4},this.shadowColor={r:0,g:255,b:255,a:.9},this.dead=!1,this.deadAngle=null,this.radius<1&&(this.radius=1);for(var n=this.target;n!==l;)n.children.push(this),n=n.target;this.draw=function(){i.strokeStyle=this.stroke,i.fillStyle=this.fill,i.beginPath(),i.arc(this.x,this.y,this.radius,0,2*Math.PI),i.shadowBlur=20,i.lineWidth=2,i.fillStyle=combineRGBA(this.fillStyle),i.strokeStyle=combineRGBA(this.strokeStyle),i.shadowColor=combineRGBA(this.shadowColor),i.fill(),i.stroke(),this.dead||(i.beginPath(),i.moveTo(this.x,this.y),i.lineWidth=this.radius,i.quadraticCurveTo(this.getMidPoint(this,this.target).x,this.getMidPoint(this,this.target).y,this.target.x,this.target.y),i.stroke())},this.update=function(){if(this.dead){if(this.interpolate(this.deadAngle.x,this.deadAngle.y,.005),this.fillStyle.r>0&&(this.fillStyle.r-=5),this.fillStyle.g>0&&(this.fillStyle.g-=5),this.fillStyle.b>0&&(this.fillStyle.b-=5),this.fillStyle.a>0&&(this.fillStyle.a-=1/255),this.strokeStyle.r>0&&(this.strokeStyle.r-=5),this.strokeStyle.g>0&&(this.strokeStyle.g-=5),this.strokeStyle.b>0&&(this.strokeStyle.b-=5),this.strokeStyle.a>0&&(this.strokeStyle.a-=1/255),this.shadowColor.r>0&&(this.shadowColor.r-=5),this.shadowColor.g>0&&(this.shadowColor.g-=5),this.shadowColor.b>0&&(this.shadowColor.b-=5),this.shadowColor.a>0&&(this.shadowColor.a-=1/255),this.radius>0&&(this.radius-=1/255),this.fillStyle.a<=0){var t=l.decaying.indexOf(this);t>-1&&l.decaying.splice(t,1)}}else{var i=this.target.getPointAlongAxis(this.target.angle+Math.degToRad(this.offsetAngle),2*this.radius);this.target===l&&(i=this.target.getPointAlongAxis(this.target.angle+Math.degToRad(this.offsetAngle+180),2*this.radius)),this.temp=i,this.distanceTo(this.target)>2*this.radius&&(this.angle=this.angleTo(this.target),this.interpolate(i.x,i.y,.2))}},this.kill=function(){if(this.dead=!0,this.deadAngle=this.getPointAlongAxis(this.angle+Math.degToRad(180),50),null!==l){var t=l.tail.indexOf(this);t>-1&&l.tail.splice(t,1),l.endPoints=0===l.tail.length?[l]:[l.tail[l.tail.length-1]],l.decaying.push(this)}}};G.prototype=new L;var N=function(t,e){this.x=t||0,this.y=e||0,this.radius=3,this.draw=function(){i.strokeStyle=this.stroke,i.fillStyle=this.fill,i.beginPath(),i.arc(this.x,this.y,this.radius,0,2*Math.PI),i.shadowBlur=20,i.lineWidth=2,i.fillStyle="rgba(0, 255, 100, 0.9)",i.strokeStyle="rgba(255, 255, 255, 0.4)",i.shadowColor="rgba(0, 255, 100, 0.9)",i.fill(),i.stroke()},this.update=function(){this.distanceTo(l)<=1.5*l.radius&&(u--,l.grow(),this.kill())}};N.prototype=new L;var U=function(e,h){this.x=e||0,this.y=h||0,this.radius=3,this.destination=this.getPointAlongAxis(this.angleTo(l),1e3),this.speed=1e3,this.draw=function(){i.strokeStyle=this.stroke,i.fillStyle=this.fill,i.beginPath(),i.arc(this.x,this.y,this.radius,0,2*Math.PI),i.shadowBlur=20,i.lineWidth=2,i.fillStyle="rgba(255, 100, 100, 0.9)",i.strokeStyle="rgba(255, 255, 255, 0.4)",i.shadowColor="rgba(255, 100, 100, 0.9)",i.fill(),i.stroke()},this.update=function(){(this.x<-20||this.y<-20||this.x>t.width+20||this.y>t.height+20)&&this.kill(),this.interpolate(this.destination.x,this.destination.y,1/(1e3-v));for(var i=l.tail.length-1;i>=0;i--)this.distanceTo(l.tail[i])<=this.radius+l.tail[i].radius&&(l.damage(l.tail[i]),this.kill())}};U.prototype=new L;var D=function(t){var i=t,e=[];this.pool=e;var h=0;this.init=function(t){if("nomnom"==t)for(var h=0;i>h;h++){var s=new Audio("nomnom.mp3");s.volume=P,s.load(),e[h]=s}else if("hit"==t)for(var h=0;i>h;h++){var s=new Audio("hit.mp3");s.volume=k,s.load(),e[h]=s}else if("death"==t)for(var h=0;i>h;h++){var s=new Audio("death.mp3");s.volume=.12,s.load(),e[h]=s}},this.get=function(){(0==e[h].currentTime||e[h].ended)&&e[h].play(),h=(h+1)%i}};
